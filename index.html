<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½å…±äº§å…šé‡è¦ä¼šè®®æ—¶é—´å›¾è°±</title>
    <style>
        :root {
            --red: #c62828;
            --red-light: #ffebee;
            --blue: #1565c0;
            --blue-light: #e3f2fd;
            --bg: #f5f6fa;
            --card: #ffffff;
            --text: #333;
            --text-light: #666;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --radius: 12px;
            --header-height: 80px;
            --sidebar-width: 70px;
            --node-gap: 30px; 
        }

        body.filter-mode-all { --node-gap: 20px; }
        body.filter-mode-congress { --node-gap: 60px; }
        body.filter-mode-plenary { --node-gap: 50px; }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; 
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }
        
        /* æ ‡é¢˜åŒº */
        .header {
            background: linear-gradient(135deg, var(--red) 0%, #8e0000 100%);
            color: white;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            position: relative;
        }
        .header h1 { font-size: 1.4em; font-weight: 600; }
        .header p { opacity: 0.8; font-size: 0.8em; margin-top: 4px; }
        
        /* ä¸»å¸ƒå±€ */
        .main-container {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            height: calc(100vh - var(--header-height));
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
        }
        
        /* å·¦ä¾§å¹´ä»½å¯¼èˆª */
        .year-nav {
            background: var(--card);
            border-right: 1px solid #eee;
            overflow-y: auto;
            scrollbar-width: thin;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0 50px 0;
        }
        .year-nav::-webkit-scrollbar { width: 0; }
        
        .year-item {
            padding: 10px 0;
            width: 100%;
            font-size: 12px;
            color: var(--text-light);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            position: relative;
        }
        .year-item:hover { color: var(--red); font-weight: bold; }
        .year-item.active {
            color: var(--red);
            font-weight: 800;
            font-size: 14px;
            background: var(--bg);
        }
        .year-item.active::before {
            content: '';
            position: absolute;
            left: 0; top: 50%; transform: translateY(-50%);
            height: 16px; width: 4px;
            background: var(--red);
            border-radius: 0 4px 4px 0;
        }
        
        /* å†…å®¹åŒº */
        .content-area {
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }
        
        /* æ§ä»¶åŒº */
        .controls {
            background: var(--card);
            border-radius: var(--radius);
            padding: 15px 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            z-index: 20;
            position: relative;
        }
        
        .filter-group {
            display: flex;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 20px;
        }
        
        .filter-btn {
            padding: 6px 16px;
            border: none;
            background: transparent;
            border-radius: 16px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
        }
        .filter-btn.active { background: white; color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-weight: 600; }
        .filter-btn[data-filter="congress"].active { color: var(--red); }
        .filter-btn[data-filter="plenary"].active { color: var(--blue); }
        
        .search-box {
            flex: 1;
            position: relative;
            min-width: 200px;
        }
        .search-box input {
            width: 100%;
            padding: 8px 15px 8px 35px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9em;
        }
        .search-box input:focus { outline: none; border-color: var(--blue); box-shadow: 0 0 0 3px var(--blue-light); }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 14px; color: #999; }

        /* å›¾ä¾‹æŒ‰é’®ä¸é¢æ¿ */
        .legend-btn {
            border: 1px solid #ddd;
            background: white;
            color: #555;
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-btn:hover { background: #f9f9f9; border-color: #ccc; }

        .legend-panel {
            position: absolute;
            top: 110%;
            right: 0;
            width: 300px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: none;
            border: 1px solid #eee;
            z-index: 100;
        }
        .legend-panel.show { display: block; animation: fadeIn 0.2s; }
        .legend-item { display: flex; gap: 10px; margin-bottom: 12px; font-size: 13px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; margin-top: 4px; flex-shrink: 0; }
        .l-red { background: var(--red); border: 2px solid var(--red-light); }
        .l-blue { background: var(--blue); border: 2px solid var(--blue-light); }
        
        /* æ—¶é—´è½´åŒºåŸŸ */
        .timeline-container {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 300px;
        }
        
        .timeline-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: var(--text-light);
        }
        
        .timeline-scroll {
            flex: 1;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 40px 20px;
            scroll-behavior: smooth;
            scrollbar-width: thin;
        }
        
        .timeline-track {
            display: flex;
            align-items: center;
            width: max-content;
            min-width: 100%;
            position: relative;
            padding: 40px 60px;
            gap: var(--node-gap);
            transition: gap 0.3s ease;
        }
        
        .timeline-track::before {
            content: '';
            position: absolute;
            left: 20px; right: 20px; top: 50%;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }
        
        /* èŠ‚ç‚¹ */
        .node {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
            flex-shrink: 0;
            width: auto;
        }
        .node.hidden { display: none; }
        .node:hover { transform: translateY(-5px); }
        .node.active { transform: scale(1.1); }
        
        .node-label {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            padding: 2px 8px;
            border-radius: 4px;
            background: white;
            border: 1px solid #eee;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }
        .node.congress .node-label { color: var(--red); border-color: var(--red-light); }
        .node.plenary .node-label { color: var(--blue); border-color: var(--blue-light); }
        
        .node-dot {
            width: 14px; height: 14px;
            background: white;
            border: 3px solid #ccc;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .node.congress .node-dot { border-color: var(--red); background: var(--red-light); }
        .node.plenary .node-dot { border-color: var(--blue); background: var(--blue-light); }
        .node.active .node-dot { background: var(--text); border-color: var(--text); box-shadow: 0 0 0 6px rgba(0,0,0,0.1); }
        
        .node-year { margin-top: 12px; font-size: 10px; color: #999; font-family: monospace; }
        
        .no-results {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #999; display: none;
        }
        .no-results.show { display: block; }
        
        /* è¯¦æƒ…æŠ½å±‰ */
        .drawer-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 900;
            opacity: 0; visibility: hidden; transition: all 0.3s;
            backdrop-filter: blur(2px);
        }
        .drawer-overlay.show { opacity: 1; visibility: visible; }
        
        .detail-drawer {
            position: fixed; top: 0; right: -500px;
            width: 450px; height: 100vh;
            background: white; z-index: 950;
            box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            transition: right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .detail-drawer.show { right: 0; }
        
        .drawer-header { padding: 30px; color: white; position: relative; flex-shrink: 0; }
        .drawer-header.congress { background: linear-gradient(135deg, var(--red), #b71c1c); }
        .drawer-header.plenary { background: linear-gradient(135deg, var(--blue), #0d47a1); }
        
        .close-drawer {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255,255,255,0.2); border: none; color: white;
            width: 30px; height: 30px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .close-drawer:hover { background: rgba(255,255,255,0.4); }
        
        .drawer-content { flex: 1; overflow-y: auto; padding: 25px; }
        .detail-block { margin-bottom: 30px; }
        .detail-block h4 { 
            font-size: 12px; color: #999; letter-spacing: 1px; 
            margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;
        }
        .detail-block p { text-align: justify; font-size: 15px; color: #444; }

        /* æ–°å¢ï¼šåº•éƒ¨å¯¼èˆªæ  */
        .drawer-footer {
            padding: 15px 25px;
            border-top: 1px solid #eee;
            background: #fff;
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #eee;
            background: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            color: var(--text);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-btn:hover:not(:disabled) { background: #eee; border-color: #ddd; }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; color: #ccc; }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .main-container { grid-template-columns: 50px 1fr; }
            .sidebar-width { width: 50px; }
            .detail-drawer {
                top: auto; bottom: -100%; right: 0;
                width: 100%; height: 80vh;
                border-radius: 20px 20px 0 0;
                transition: bottom 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            }
            .detail-drawer.show { bottom: 0; right: 0; }
            .controls { padding: 10px; gap: 10px; justify-content: space-between; }
            .search-box { width: 100%; order: 3; }
            .legend-panel { right: auto; left: 0; width: 100%; top: 120%; }
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="filter-mode-all">

<header class="header">
    <h1>ä¸­å›½å…±äº§å…šé‡è¦ä¼šè®®æ—¶é—´å›¾è°±</h1>
    <p>å…šä»£ä¼šä¸ä¸­å¤®å…¨ä¼šå†å²æ²¿é©</p>
</header>

<div class="main-container">
    <nav class="year-nav" id="year-nav"></nav>
    
    <div class="content-area">
        <div class="controls">
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="congress">å…šä»£ä¼š</button>
                <button class="filter-btn" data-filter="plenary">å…¨ä¼š</button>
            </div>
            
            <div style="position: relative;">
                <button class="legend-btn" id="legend-toggle">ğŸ“– ä¼šè®®è¯´æ˜</button>
                <div class="legend-panel" id="legend-panel">
                    <div class="legend-item">
                        <div class="legend-dot l-red"></div>
                        <div>
                            <strong>å…šçš„å…¨å›½ä»£è¡¨å¤§ä¼š (å…šä»£ä¼š)</strong>
                            <div style="color:#666; margin-top:2px;">å…šçš„æœ€é«˜é¢†å¯¼æœºå…³ï¼Œæ¯äº”å¹´ä¸¾è¡Œä¸€æ¬¡ã€‚è´Ÿè´£åˆ¶å®šå…šçš„çº²é¢†è·¯çº¿ï¼Œé€‰ä¸¾ä¸­å¤®å§”å‘˜ä¼šã€‚</div>
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot l-blue"></div>
                        <div>
                            <strong>ä¸­å¤®å§”å‘˜ä¼šå…¨ä½“ä¼šè®® (å…¨ä¼š)</strong>
                            <div style="color:#666; margin-top:2px;">åœ¨å…šä»£ä¼šé—­ä¼šæœŸé—´çš„é¢†å¯¼æœºæ„ã€‚é€šå¸¸æ¯å¹´è‡³å°‘å¬å¼€ä¸€æ¬¡ï¼Œç ”ç©¶å…·ä½“é‡å¤§é—®é¢˜ã€‚</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="search-input" placeholder="æœç´¢ä¼šè®®...">
            </div>
        </div>
        
        <div class="timeline-container">
            <div class="timeline-header">
                <span>æ—¶é—´è½´</span>
                <span style="font-size: 0.8em; opacity: 0.7">æŒ‰ä½ Shift æ»šè½®å¯æ¨ªå‘æ»šåŠ¨</span>
            </div>
            <div class="timeline-scroll" id="timeline-scroll">
                <div class="timeline-track" id="timeline-track"></div>
            </div>
            <div class="no-results" id="no-results">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¼šè®®</div>
        </div>
    </div>
</div>

<div class="drawer-overlay" id="drawer-overlay"></div>
<aside class="detail-drawer" id="detail-drawer">
    <div class="drawer-header" id="drawer-header">
        <button class="close-drawer" id="close-drawer">Ã—</button>
        <h2 id="d-title" style="margin-bottom: 5px; font-size: 1.4em;"></h2>
        <div style="font-size: 0.9em; opacity: 0.9;">
            <span id="d-time"></span> Â· <span id="d-place"></span>
        </div>
    </div>
    <div class="drawer-content">
        <div class="detail-block">
            <h4>ä¼šè®®å†…å®¹</h4>
            <p id="d-desc"></p>
        </div>
        <div class="detail-block" style="background: #fffbf0; padding: 15px; border-radius: 8px;">
            <h4 style="color: #b76e00; border-color: #ffe0b2;">å†å²æ„ä¹‰</h4>
            <p id="d-significance" style="color: #5d4037;"></p>
        </div>
    </div>
    <div class="drawer-footer">
        <button class="nav-btn" id="nav-prev">â† ä¸Šä¸€ä¼šè®®</button>
        <button class="nav-btn" id="nav-next">ä¸‹ä¸€ä¼šè®® â†’</button>
    </div>
</aside>

<script>
    // æ•°æ®æº
    const data = [
        { id: 1, name: 'ä¸€å¤§', full: 'ä¸­å…±ä¸€å¤§', time: '1921-07', year: 1921, place: 'ä¸Šæµ·â†’å˜‰å…´', type: 'congress', desc: 'ä¸­å›½å…±äº§å…šç¬¬ä¸€æ¬¡å…¨å›½ä»£è¡¨å¤§ä¼šï¼Œå®£å‘Šä¸­å›½å…±äº§å…šæ­£å¼æˆç«‹ã€‚å¤§ä¼šç¡®å®šå…šçš„åç§°ä¸º"ä¸­å›½å…±äº§å…š"ï¼Œé€šè¿‡äº†å…šçš„ç¬¬ä¸€ä¸ªçº²é¢†ã€‚', significance: 'æ ‡å¿—ç€ä¸­å›½å…±äº§å…šçš„è¯ç”Ÿï¼Œä¸­å›½é©å‘½é¢è²Œä»æ­¤ç„•ç„¶ä¸€æ–°ã€‚' },
        { id: 2, name: 'äºŒå¤§', full: 'ä¸­å…±äºŒå¤§', time: '1922-07', year: 1922, place: 'ä¸Šæµ·', type: 'congress', desc: 'ç¬¬ä¸€æ¬¡æå‡ºåå¸åå°å»ºçš„æ°‘ä¸»é©å‘½çº²é¢†ï¼Œåˆ¶å®šäº†å…šçš„ç¬¬ä¸€éƒ¨ç« ç¨‹ã€‚', significance: 'ç¬¬ä¸€æ¬¡æ˜ç¡®æå‡ºå…šçš„æœ€é«˜çº²é¢†å’Œæœ€ä½çº²é¢†ã€‚' },
        { id: 3, name: 'ä¸‰å¤§', full: 'ä¸­å…±ä¸‰å¤§', time: '1923-06', year: 1923, place: 'å¹¿å·', type: 'congress', desc: 'å†³å®šå…±äº§å…šå‘˜ä»¥ä¸ªäººèº«ä»½åŠ å…¥å›½æ°‘å…šï¼Œå®ç°å›½å…±åˆä½œã€‚', significance: 'ç¡®ç«‹å›½å…±åˆä½œæ–¹é’ˆï¼Œæ¨åŠ¨ç¬¬ä¸€æ¬¡å›½å…±åˆä½œå®ç°ã€‚' },
        { id: 4, name: 'å››å¤§', full: 'ä¸­å…±å››å¤§', time: '1925-01', year: 1925, place: 'ä¸Šæµ·', type: 'congress', desc: 'ç¬¬ä¸€æ¬¡æ˜ç¡®æå‡ºæ— äº§é˜¶çº§åœ¨æ°‘ä¸»é©å‘½ä¸­çš„é¢†å¯¼æƒå’Œå·¥å†œè”ç›Ÿé—®é¢˜ã€‚', significance: 'æå‡ºæ— äº§é˜¶çº§é¢†å¯¼æƒå’Œå·¥å†œè”ç›Ÿçš„é‡è¦æ€æƒ³ã€‚' },
        { id: 5, name: 'äº”å¤§', full: 'ä¸­å…±äº”å¤§', time: '1927-04', year: 1927, place: 'æ­¦æ±‰', type: 'congress', desc: 'åœ¨å¤§é©å‘½ç´§æ€¥å…³å¤´å¬å¼€ï¼Œæ‰¹è¯„äº†é™ˆç‹¬ç§€çš„å³å€¾é”™è¯¯ã€‚', significance: 'ç¬¬ä¸€æ¬¡é€‰ä¸¾äº§ç”Ÿä¸­å¤®ç›‘å¯Ÿå§”å‘˜ä¼šã€‚' },
        { id: 6, name: 'å…­å¤§', full: 'ä¸­å…±å…­å¤§', time: '1928-06', year: 1928, place: 'è«æ–¯ç§‘', type: 'congress', desc: 'å”¯ä¸€ä¸€æ¬¡åœ¨å›½å¤–å¬å¼€çš„å…šä»£ä¼šï¼Œæ€»ç»“å¤§é©å‘½å¤±è´¥çš„æ•™è®­ã€‚', significance: 'æ˜ç¡®ä¸­å›½é©å‘½çš„æ€§è´¨å’Œä»»åŠ¡ã€‚' },
        { id: 7, name: 'ä¸ƒå¤§', full: 'ä¸­å…±ä¸ƒå¤§', time: '1945-04', year: 1945, place: 'å»¶å®‰', type: 'congress', desc: 'ç¡®ç«‹æ¯›æ³½ä¸œæ€æƒ³ä¸ºå…šçš„æŒ‡å¯¼æ€æƒ³ï¼Œæ€»ç»“å…šçš„å†å²ç»éªŒã€‚', significance: 'å®ç°å…¨å…šç©ºå‰å›¢ç»“ç»Ÿä¸€ï¼Œä¸ºæŠ—æˆ˜å’Œè§£æ”¾æˆ˜äº‰èƒœåˆ©å¥ å®šåŸºç¡€ã€‚' },
        { id: 101, name: 'ä¸ƒå±ŠäºŒä¸­', full: 'ä¸ƒå±ŠäºŒä¸­å…¨ä¼š', time: '1949-03', year: 1949, place: 'è¥¿æŸå¡', type: 'plenary', desc: 'æå‡ºå…šçš„å·¥ä½œé‡å¿ƒç”±ä¹¡æ‘è½¬ç§»åˆ°åŸå¸‚çš„æˆ˜ç•¥æ–¹é’ˆï¼Œæå‡º"ä¸¤ä¸ªåŠ¡å¿…"æ€æƒ³ã€‚', significance: 'ä¸ºæ–°ä¸­å›½å»ºç«‹ä½œäº†æ”¿æ²»ã€æ€æƒ³ä¸Šçš„å‡†å¤‡ã€‚' },
        { id: 8, name: 'å…«å¤§', full: 'ä¸­å…±å…«å¤§', time: '1956-09', year: 1956, place: 'åŒ—äº¬', type: 'congress', desc: 'æ­£ç¡®åˆ†æå›½å†…ä¸»è¦çŸ›ç›¾å˜åŒ–ï¼Œæå‡ºç¤¾ä¼šä¸»ä¹‰å»ºè®¾ä»»åŠ¡ã€‚', significance: 'æ˜¯æ¢ç´¢ç¤¾ä¼šä¸»ä¹‰å»ºè®¾é“è·¯çš„è‰¯å¥½å¼€ç«¯ã€‚' },
        { id: 9, name: 'ä¹å¤§', full: 'ä¸­å…±ä¹å¤§', time: '1969-04', year: 1969, place: 'åŒ—äº¬', type: 'congress', desc: 'åœ¨æ–‡åŒ–å¤§é©å‘½ä¸­å¬å¼€ï¼Œä½¿"æ–‡åŒ–å¤§é©å‘½"çš„é”™è¯¯ç†è®ºå’Œå®è·µåˆæ³•åŒ–ã€‚', significance: 'è¿™æ˜¯å…šçš„å†å²ä¸Šçš„ä¸€æ¬¡å¤±è¯¯ã€‚' },
        { id: 10, name: 'åå¤§', full: 'ä¸­å…±åå¤§', time: '1973-08', year: 1973, place: 'åŒ—äº¬', type: 'congress', desc: 'ç»§ç»­ä¹å¤§çš„"å·¦"å€¾é”™è¯¯ã€‚', significance: 'æœªèƒ½çº æ­£"æ–‡åŒ–å¤§é©å‘½"çš„é”™è¯¯ã€‚' },
        { id: 11, name: 'åä¸€å¤§', full: 'ä¸­å…±åä¸€å¤§', time: '1977-08', year: 1977, place: 'åŒ—äº¬', type: 'congress', desc: 'å®£å‘Š"æ–‡åŒ–å¤§é©å‘½"ç»“æŸï¼Œä½†ä»è‚¯å®šå…¶é”™è¯¯ç†è®ºã€‚', significance: 'æ ‡å¿—ç€"æ–‡åŒ–å¤§é©å‘½"ç»“æŸåå…šçš„å·¥ä½œå¼€å§‹è½¬æŠ˜ã€‚' },
        { id: 102, name: 'åä¸€å±Šä¸‰ä¸­', full: 'åä¸€å±Šä¸‰ä¸­å…¨ä¼š', time: '1978-12', year: 1978, place: 'åŒ—äº¬', type: 'plenary', desc: 'é‡æ–°ç¡®ç«‹è§£æ”¾æ€æƒ³ã€å®äº‹æ±‚æ˜¯çš„æ€æƒ³è·¯çº¿ï¼Œä½œå‡ºæŠŠå·¥ä½œä¸­å¿ƒè½¬ç§»åˆ°ç»æµå»ºè®¾ä¸Šæ¥ã€å®è¡Œæ”¹é©å¼€æ”¾çš„å†å²æ€§å†³ç­–ã€‚', significance: 'å¼€å¯æ”¹é©å¼€æ”¾å’Œç¤¾ä¼šä¸»ä¹‰ç°ä»£åŒ–å»ºè®¾ä¼Ÿå¤§å¾ç¨‹ï¼Œå®ç°ä¼Ÿå¤§å†å²è½¬æŠ˜ã€‚' },
        { id: 103, name: 'åä¸€å±Šå…­ä¸­', full: 'åä¸€å±Šå…­ä¸­å…¨ä¼š', time: '1981-06', year: 1981, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºå»ºå›½ä»¥æ¥å…šçš„è‹¥å¹²å†å²é—®é¢˜çš„å†³è®®ã€‹ï¼Œå®äº‹æ±‚æ˜¯è¯„ä»·æ¯›æ³½ä¸œå†å²åœ°ä½ã€‚', significance: 'æ ‡å¿—ç€å…šåœ¨æŒ‡å¯¼æ€æƒ³ä¸Šæ‹¨ä¹±åæ­£èƒœåˆ©å®Œæˆã€‚' },
        { id: 12, name: 'åäºŒå¤§', full: 'ä¸­å…±åäºŒå¤§', time: '1982-09', year: 1982, place: 'åŒ—äº¬', type: 'congress', desc: 'æå‡º"å»ºè®¾æœ‰ä¸­å›½ç‰¹è‰²çš„ç¤¾ä¼šä¸»ä¹‰"é‡å¤§å‘½é¢˜ã€‚', significance: 'å¼€åˆ›ç¤¾ä¼šä¸»ä¹‰ç°ä»£åŒ–å»ºè®¾æ–°å±€é¢ã€‚' },
        { id: 104, name: 'åäºŒå±Šä¸‰ä¸­', full: 'åäºŒå±Šä¸‰ä¸­å…¨ä¼š', time: '1984-10', year: 1984, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºç»æµä½“åˆ¶æ”¹é©çš„å†³å®šã€‹ï¼Œçªç ´è®¡åˆ’ç»æµä¸å•†å“ç»æµå¯¹ç«‹çš„ä¼ ç»Ÿè§‚å¿µã€‚', significance: 'æ ‡å¿—ç€ä»¥åŸå¸‚ä¸ºé‡ç‚¹çš„ç»æµä½“åˆ¶æ”¹é©å…¨é¢å±•å¼€ã€‚' },
        { id: 13, name: 'åä¸‰å¤§', full: 'ä¸­å…±åä¸‰å¤§', time: '1987-10', year: 1987, place: 'åŒ—äº¬', type: 'congress', desc: 'ç³»ç»Ÿé˜è¿°ç¤¾ä¼šä¸»ä¹‰åˆçº§é˜¶æ®µç†è®ºï¼Œæå‡º"ä¸€ä¸ªä¸­å¿ƒã€ä¸¤ä¸ªåŸºæœ¬ç‚¹"åŸºæœ¬è·¯çº¿ã€‚', significance: 'ç¡®ç«‹ç¤¾ä¼šä¸»ä¹‰åˆçº§é˜¶æ®µç†è®ºä½“ç³»ã€‚' },
        { id: 14, name: 'åå››å¤§', full: 'ä¸­å…±åå››å¤§', time: '1992-10', year: 1992, place: 'åŒ—äº¬', type: 'congress', desc: 'ç¡®ç«‹ç¤¾ä¼šä¸»ä¹‰å¸‚åœºç»æµä½“åˆ¶æ”¹é©ç›®æ ‡ï¼Œç¡®ç«‹é‚“å°å¹³ç†è®ºæŒ‡å¯¼åœ°ä½ã€‚', significance: 'æ ‡å¿—ç€æ”¹é©å¼€æ”¾å’Œç°ä»£åŒ–å»ºè®¾è¿›å…¥æ–°é˜¶æ®µã€‚' },
        { id: 105, name: 'åå››å±Šä¸‰ä¸­', full: 'åå››å±Šä¸‰ä¸­å…¨ä¼š', time: '1993-11', year: 1993, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºå»ºç«‹ç¤¾ä¼šä¸»ä¹‰å¸‚åœºç»æµä½“åˆ¶è‹¥å¹²é—®é¢˜çš„å†³å®šã€‹ã€‚', significance: 'å‹¾ç”»ç¤¾ä¼šä¸»ä¹‰å¸‚åœºç»æµä½“åˆ¶åŸºæœ¬æ¡†æ¶ã€‚' },
        { id: 15, name: 'åäº”å¤§', full: 'ä¸­å…±åäº”å¤§', time: '1997-09', year: 1997, place: 'åŒ—äº¬', type: 'congress', desc: 'æŠŠé‚“å°å¹³ç†è®ºç¡®ç«‹ä¸ºå…šçš„æŒ‡å¯¼æ€æƒ³ï¼Œæå‡ºå…šåœ¨ç¤¾ä¼šä¸»ä¹‰åˆçº§é˜¶æ®µçš„åŸºæœ¬çº²é¢†ã€‚', significance: 'é«˜ä¸¾é‚“å°å¹³ç†è®ºä¼Ÿå¤§æ——å¸œï¼Œæ¨è¿›æ”¹é©å¼€æ”¾ã€‚' },
        { id: 106, name: 'åäº”å±Šä¸‰ä¸­', full: 'åäº”å±Šä¸‰ä¸­å…¨ä¼š', time: '1998-10', year: 1998, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºå†œä¸šå’Œå†œæ‘å·¥ä½œè‹¥å¹²é‡å¤§é—®é¢˜çš„å†³å®šã€‹ã€‚', significance: 'æ¨è¿›å†œæ‘æ”¹é©å‘å±•çš„é‡è¦ä¼šè®®ã€‚' },
        { id: 16, name: 'åå…­å¤§', full: 'ä¸­å…±åå…­å¤§', time: '2002-11', year: 2002, place: 'åŒ—äº¬', type: 'congress', desc: 'æŠŠ"ä¸‰ä¸ªä»£è¡¨"é‡è¦æ€æƒ³ç¡®ç«‹ä¸ºå…šçš„æŒ‡å¯¼æ€æƒ³ï¼Œæå‡ºå…¨é¢å»ºè®¾å°åº·ç¤¾ä¼šå¥‹æ–—ç›®æ ‡ã€‚', significance: 'å®ç°å…šçš„é¢†å¯¼é›†ä½“æ–°è€äº¤æ›¿ã€‚' },
        { id: 107, name: 'åå…­å±Šä¸‰ä¸­', full: 'åå…­å±Šä¸‰ä¸­å…¨ä¼š', time: '2003-10', year: 2003, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºå®Œå–„ç¤¾ä¼šä¸»ä¹‰å¸‚åœºç»æµä½“åˆ¶è‹¥å¹²é—®é¢˜çš„å†³å®šã€‹ã€‚', significance: 'æ¨åŠ¨å®Œå–„ç¤¾ä¼šä¸»ä¹‰å¸‚åœºç»æµä½“åˆ¶ã€‚' },
        { id: 108, name: 'åå…­å±Šå››ä¸­', full: 'åå…­å±Šå››ä¸­å…¨ä¼š', time: '2004-09', year: 2004, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºåŠ å¼ºå…šçš„æ‰§æ”¿èƒ½åŠ›å»ºè®¾çš„å†³å®šã€‹ã€‚', significance: 'é¦–æ¬¡æŠŠæ‰§æ”¿èƒ½åŠ›å»ºè®¾ä½œä¸ºä¸­å¤®å…¨ä¼šä¸»é¢˜ã€‚' },
        { id: 17, name: 'åä¸ƒå¤§', full: 'ä¸­å…±åä¸ƒå¤§', time: '2007-10', year: 2007, place: 'åŒ—äº¬', type: 'congress', desc: 'å¯¹ç§‘å­¦å‘å±•è§‚ä½œå‡ºç§‘å­¦ç•Œå®šï¼Œæå‡ºå®ç°å…¨é¢å»ºè®¾å°åº·ç¤¾ä¼šå¥‹æ–—ç›®æ ‡çš„æ–°è¦æ±‚ã€‚', significance: 'æ·±å…¥è´¯å½»è½å®ç§‘å­¦å‘å±•è§‚ã€‚' },
        { id: 109, name: 'åä¸ƒå±Šä¸‰ä¸­', full: 'åä¸ƒå±Šä¸‰ä¸­å…¨ä¼š', time: '2008-10', year: 2008, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºæ¨è¿›å†œæ‘æ”¹é©å‘å±•è‹¥å¹²é‡å¤§é—®é¢˜çš„å†³å®šã€‹ã€‚', significance: 'æ¨è¿›æ–°å½¢åŠ¿ä¸‹å†œæ‘æ”¹é©å‘å±•ã€‚' },
        { id: 18, name: 'åå…«å¤§', full: 'ä¸­å…±åå…«å¤§', time: '2012-11', year: 2012, place: 'åŒ—äº¬', type: 'congress', desc: 'ç¡®å®šå…¨é¢å»ºæˆå°åº·ç¤¾ä¼šå’Œå…¨é¢æ·±åŒ–æ”¹é©å¼€æ”¾ç›®æ ‡ï¼Œç¡®ç«‹ç§‘å­¦å‘å±•è§‚å†å²åœ°ä½ã€‚', significance: 'ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰è¿›å…¥æ–°æ—¶ä»£çš„èµ·ç‚¹ã€‚' },
        { id: 110, name: 'åå…«å±Šä¸‰ä¸­', full: 'åå…«å±Šä¸‰ä¸­å…¨ä¼š', time: '2013-11', year: 2013, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºå…¨é¢æ·±åŒ–æ”¹é©è‹¥å¹²é‡å¤§é—®é¢˜çš„å†³å®šã€‹ï¼Œæå‡ºå¸‚åœºåœ¨èµ„æºé…ç½®ä¸­èµ·å†³å®šæ€§ä½œç”¨ã€‚', significance: 'å¹å“å…¨é¢æ·±åŒ–æ”¹é©çš„å·è§’ã€‚' },
        { id: 111, name: 'åå…«å±Šå››ä¸­', full: 'åå…«å±Šå››ä¸­å…¨ä¼š', time: '2014-10', year: 2014, place: 'åŒ—äº¬', type: 'plenary', desc: 'é€šè¿‡ã€Šå…³äºå…¨é¢æ¨è¿›ä¾æ³•æ²»å›½è‹¥å¹²é‡å¤§é—®é¢˜çš„å†³å®šã€‹ã€‚', significance: 'é¦–æ¬¡ä»¥ä¸­å¤®å…¨ä¼šä¸“é¢˜ç ”ç©¶å…¨é¢æ¨è¿›ä¾æ³•æ²»å›½ã€‚' },
        { id: 112, name: 'åå…«å±Šäº”ä¸­', full: 'åå…«å±Šäº”ä¸­å…¨ä¼š', time: '2015-10', year: 2015, place: 'åŒ—äº¬', type: 'plenary', desc: 'å®¡è®®é€šè¿‡"åä¸‰äº”"è§„åˆ’å»ºè®®ï¼Œæå‡ºåˆ›æ–°ã€åè°ƒã€ç»¿è‰²ã€å¼€æ”¾ã€å…±äº«æ–°å‘å±•ç†å¿µã€‚', significance: 'ç¡®ç«‹æ–°å‘å±•ç†å¿µã€‚' },
        { id: 113, name: 'åå…«å±Šå…­ä¸­', full: 'åå…«å±Šå…­ä¸­å…¨ä¼š', time: '2016-10', year: 2016, place: 'åŒ—äº¬', type: 'plenary', desc: 'æ­£å¼æå‡º"ä»¥ä¹ è¿‘å¹³åŒå¿—ä¸ºæ ¸å¿ƒçš„å…šä¸­å¤®"ï¼Œå®¡è®®é€šè¿‡å…šå†…æ”¿æ²»ç”Ÿæ´»å‡†åˆ™ã€‚', significance: 'å…¨é¢ä»ä¸¥æ²»å…šå‘çºµæ·±æ¨è¿›ã€‚' },
        { id: 19, name: 'åä¹å¤§', full: 'ä¸­å…±åä¹å¤§', time: '2017-10', year: 2017, place: 'åŒ—äº¬', type: 'congress', desc: 'æŠŠä¹ è¿‘å¹³æ–°æ—¶ä»£ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰æ€æƒ³ç¡®ç«‹ä¸ºå…šçš„æŒ‡å¯¼æ€æƒ³ã€‚', significance: 'å®£å‘Šä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰è¿›å…¥æ–°æ—¶ä»£ã€‚' },
        { id: 114, name: 'åä¹å±Šä¸‰ä¸­', full: 'åä¹å±Šä¸‰ä¸­å…¨ä¼š', time: '2018-02', year: 2018, place: 'åŒ—äº¬', type: 'plenary', desc: 'å®¡è®®é€šè¿‡ã€Šå…³äºæ·±åŒ–å…šå’Œå›½å®¶æœºæ„æ”¹é©çš„å†³å®šã€‹å’Œæ”¹é©æ–¹æ¡ˆã€‚', significance: 'æ¨è¿›å›½å®¶æ²»ç†ä½“ç³»å’Œæ²»ç†èƒ½åŠ›ç°ä»£åŒ–çš„é‡å¤§å†³ç­–ã€‚' },
        { id: 115, name: 'åä¹å±Šå››ä¸­', full: 'åä¹å±Šå››ä¸­å…¨ä¼š', time: '2019-10', year: 2019, place: 'åŒ—äº¬', type: 'plenary', desc: 'å®¡è®®é€šè¿‡ã€Šå…³äºåšæŒå’Œå®Œå–„ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰åˆ¶åº¦ã€æ¨è¿›å›½å®¶æ²»ç†ä½“ç³»å’Œæ²»ç†èƒ½åŠ›ç°ä»£åŒ–è‹¥å¹²é‡å¤§é—®é¢˜çš„å†³å®šã€‹ã€‚', significance: 'ç³»ç»Ÿæ€»ç»“ä¸­å›½å›½å®¶åˆ¶åº¦å’Œå›½å®¶æ²»ç†ä½“ç³»æ˜¾è‘—ä¼˜åŠ¿ã€‚' },
        { id: 116, name: 'åä¹å±Šäº”ä¸­', full: 'åä¹å±Šäº”ä¸­å…¨ä¼š', time: '2020-10', year: 2020, place: 'åŒ—äº¬', type: 'plenary', desc: 'å®¡è®®é€šè¿‡"åå››äº”"è§„åˆ’å’Œ2035å¹´è¿œæ™¯ç›®æ ‡å»ºè®®ã€‚', significance: 'æ“˜ç”»ä¸­å›½æœªæ¥å‘å±•è“å›¾ã€‚' },
        { id: 117, name: 'åä¹å±Šå…­ä¸­', full: 'åä¹å±Šå…­ä¸­å…¨ä¼š', time: '2021-11', year: 2021, place: 'åŒ—äº¬', type: 'plenary', desc: 'å®¡è®®é€šè¿‡ã€Šå…³äºå…šçš„ç™¾å¹´å¥‹æ–—é‡å¤§æˆå°±å’Œå†å²ç»éªŒçš„å†³è®®ã€‹ã€‚', significance: 'å…šçš„ç¬¬ä¸‰ä¸ªå†å²å†³è®®ï¼Œæ€»ç»“ç™¾å¹´å¥‹æ–—é‡å¤§æˆå°±å’Œå†å²ç»éªŒã€‚' },
        { id: 20, name: 'äºŒåå¤§', full: 'ä¸­å…±äºŒåå¤§', time: '2022-10', year: 2022, place: 'åŒ—äº¬', type: 'congress', desc: 'å…¨é¢æ€»ç»“æ–°æ—¶ä»£åå¹´ä¼Ÿå¤§å˜é©ï¼Œå¯¹å…¨é¢å»ºè®¾ç¤¾ä¼šä¸»ä¹‰ç°ä»£åŒ–å›½å®¶ä½œå‡ºæˆ˜ç•¥éƒ¨ç½²ã€‚', significance: 'å…¨é¢å»ºè®¾ç¤¾ä¼šä¸»ä¹‰ç°ä»£åŒ–å›½å®¶æ–°å¾ç¨‹ä¸Šçš„å…³é”®ä¼šè®®ã€‚' },
        { id: 118, name: 'äºŒåå±Šä¸‰ä¸­', full: 'äºŒåå±Šä¸‰ä¸­å…¨ä¼š', time: '2024-07', year: 2024, place: 'åŒ—äº¬', type: 'plenary', desc: 'å®¡è®®é€šè¿‡ã€Šå…³äºè¿›ä¸€æ­¥å…¨é¢æ·±åŒ–æ”¹é©ã€æ¨è¿›ä¸­å›½å¼ç°ä»£åŒ–çš„å†³å®šã€‹ã€‚', significance: 'å¯¹è¿›ä¸€æ­¥å…¨é¢æ·±åŒ–æ”¹é©ä½œå‡ºç³»ç»Ÿéƒ¨ç½²ã€‚' }
    ];

    data.sort((a, b) => a.time.localeCompare(b.time));

    let state = {
        filter: 'all',
        search: '',
        visibleIds: [] // å­˜å‚¨å½“å‰ç­›é€‰ä¸‹å¯è§çš„ ID åˆ—è¡¨ï¼Œç”¨äºä¸Šä¸‹æ–‡å¯¼èˆª
    };

    const DOM = {
        track: document.getElementById('timeline-track'),
        yearNav: document.getElementById('year-nav'),
        scroll: document.getElementById('timeline-scroll'),
        drawer: document.getElementById('detail-drawer'),
        overlay: document.getElementById('drawer-overlay'),
        noResults: document.getElementById('no-results'),
        legendPanel: document.getElementById('legend-panel'),
        btnPrev: document.getElementById('nav-prev'),
        btnNext: document.getElementById('nav-next')
    };

    function init() {
        renderNodes();
        updateView();
        bindEvents();
    }

    function renderNodes() {
        DOM.track.innerHTML = '';
        data.forEach(item => {
            const el = document.createElement('div');
            el.className = `node ${item.type}`;
            el.dataset.id = item.id;
            el.dataset.year = item.year;
            el.dataset.type = item.type;
            el.dataset.search = `${item.name} ${item.full} ${item.time} ${item.year}`.toLowerCase();
            
            el.innerHTML = `
                <div class="node-label">${item.name}</div>
                <div class="node-dot"></div>
                <div class="node-year">${item.time}</div>
            `;
            
            el.addEventListener('click', () => openDrawer(item, el));
            DOM.track.appendChild(el);
        });
    }

    function updateView() {
        const nodes = document.querySelectorAll('.node');
        const visibleYears = new Set();
        let hasVisible = false;
        state.visibleIds = []; // é‡ç½®å¯è§ ID

        nodes.forEach(node => {
            const matchType = state.filter === 'all' || node.dataset.type === state.filter;
            const matchSearch = !state.search || node.dataset.search.includes(state.search);
            const isVisible = matchType && matchSearch;
            
            if (isVisible) {
                node.classList.remove('hidden');
                visibleYears.add(parseInt(node.dataset.year));
                state.visibleIds.push(parseInt(node.dataset.id)); // è®°å½•å¯è§ID
                hasVisible = true;
            } else {
                node.classList.add('hidden');
            }
        });

        DOM.noResults.classList.toggle('show', !hasVisible);
        renderYearNav(Array.from(visibleYears).sort((a,b) => a - b));
        document.body.className = `filter-mode-${state.filter}`;
    }

    function renderYearNav(years) {
        DOM.yearNav.innerHTML = '';
        years.forEach(year => {
            const div = document.createElement('div');
            div.className = 'year-item';
            div.textContent = year;
            div.dataset.year = year;
            div.onclick = () => scrollToYear(year);
            DOM.yearNav.appendChild(div);
        });
        updateActiveYear();
    }

    function scrollToYear(year) {
        const targetNode = document.querySelector(`.node[data-year="${year}"]:not(.hidden)`);
        if (targetNode) {
            scrollToNode(targetNode);
        }
    }
    
    // é€šç”¨ï¼šæ»šåŠ¨åˆ°æŸä¸ªèŠ‚ç‚¹å¹¶å±…ä¸­
    function scrollToNode(nodeEl) {
        const scrollLeft = nodeEl.offsetLeft - DOM.scroll.offsetWidth / 2 + nodeEl.offsetWidth / 2;
        DOM.scroll.scrollTo({ left: scrollLeft, behavior: 'smooth' });
    }

    function updateActiveYear() {
        const scrollCenter = DOM.scroll.scrollLeft + DOM.scroll.offsetWidth / 2;
        const visibleNodes = document.querySelectorAll('.node:not(.hidden)');
        let closestNode = null;
        let minDiff = Infinity;

        visibleNodes.forEach(node => {
            const diff = Math.abs((node.offsetLeft + node.offsetWidth/2) - scrollCenter);
            if (diff < minDiff) {
                minDiff = diff;
                closestNode = node;
            }
        });

        if (closestNode) {
            const year = closestNode.dataset.year;
            document.querySelectorAll('.year-item').forEach(y => {
                const isActive = y.dataset.year === year;
                y.classList.toggle('active', isActive);
                if (isActive) {
                    y.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        }
    }

    function openDrawer(item, nodeEl) {
        document.querySelectorAll('.node').forEach(n => n.classList.remove('active'));
        if(!nodeEl) {
             nodeEl = document.querySelector(`.node[data-id="${item.id}"]`);
        }
        if(nodeEl) {
             nodeEl.classList.add('active');
             // æ‰“å¼€è¯¦æƒ…æ—¶ï¼Œè‡ªåŠ¨æ»šåŠ¨æ—¶é—´è½´ä½¿è¯¥èŠ‚ç‚¹å¯è§ï¼ˆä½“éªŒæ›´å¥½ï¼‰
             scrollToNode(nodeEl);
        }

        document.getElementById('d-title').textContent = item.full;
        document.getElementById('d-time').textContent = formatTime(item.time);
        document.getElementById('d-place').textContent = item.place;
        document.getElementById('d-desc').textContent = item.desc;
        document.getElementById('d-significance').textContent = item.significance;
        
        const header = document.getElementById('drawer-header');
        header.className = 'drawer-header ' + item.type;

        DOM.drawer.classList.add('show');
        DOM.overlay.classList.add('show');

        // æ›´æ–°ä¸Šä¸‹æ–‡æŒ‰é’®çŠ¶æ€
        updateNavButtons(item.id);
    }

    // æ›´æ–°ä¸Šä¸€æ¡/ä¸‹ä¸€æ¡æŒ‰é’®
    function updateNavButtons(currentId) {
        const currentIndex = state.visibleIds.indexOf(currentId);
        
        // ä¸Šä¸€æ¡
        if (currentIndex > 0) {
            const prevId = state.visibleIds[currentIndex - 1];
            DOM.btnPrev.disabled = false;
            DOM.btnPrev.onclick = () => {
                const prevItem = data.find(d => d.id === prevId);
                openDrawer(prevItem);
            };
        } else {
            DOM.btnPrev.disabled = true;
            DOM.btnPrev.onclick = null;
        }

        // ä¸‹ä¸€æ¡
        if (currentIndex < state.visibleIds.length - 1) {
            const nextId = state.visibleIds[currentIndex + 1];
            DOM.btnNext.disabled = false;
            DOM.btnNext.onclick = () => {
                const nextItem = data.find(d => d.id === nextId);
                openDrawer(nextItem);
            };
        } else {
            DOM.btnNext.disabled = true;
            DOM.btnNext.onclick = null;
        }
    }

    function closeDrawer() {
        DOM.drawer.classList.remove('show');
        DOM.overlay.classList.remove('show');
        document.querySelectorAll('.node').forEach(n => n.classList.remove('active'));
    }

    function formatTime(t) {
        const [y, m] = t.split('-');
        return `${y}å¹´${m}æœˆ`;
    }

    function bindEvents() {
        // ç­›é€‰
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                state.filter = e.currentTarget.dataset.filter;
                updateView();
            });
        });

        // å›¾ä¾‹å¼€å…³
        const legendBtn = document.getElementById('legend-toggle');
        legendBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // é˜²æ­¢å†’æ³¡å…³é—­
            DOM.legendPanel.classList.toggle('show');
            legendBtn.textContent = DOM.legendPanel.classList.contains('show') ? 'ğŸ“– æ”¶èµ·è¯´æ˜' : 'ğŸ“– ä¼šè®®è¯´æ˜';
        });

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­å›¾ä¾‹
        document.addEventListener('click', (e) => {
            if (!DOM.legendPanel.contains(e.target) && e.target !== legendBtn) {
                DOM.legendPanel.classList.remove('show');
                legendBtn.textContent = 'ğŸ“– ä¼šè®®è¯´æ˜';
            }
        });

        // æœç´¢
        let timer;
        document.getElementById('search-input').addEventListener('input', (e) => {
            clearTimeout(timer);
            timer = setTimeout(() => {
                state.search = e.target.value.trim().toLowerCase();
                updateView();
            }, 300);
        });

        DOM.scroll.addEventListener('scroll', () => {
            if(!timer) {
                timer = setTimeout(() => {
                    updateActiveYear();
                    timer = null;
                }, 100);
            }
        });

        document.getElementById('close-drawer').onclick = closeDrawer;
        DOM.overlay.onclick = closeDrawer;
    }

    init();

</script>
</body>
</html>
